
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Python SDK iottly &#8212; iottly-sdk 1.2.0 documentation</title>
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Installation" href="installation.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="python-sdk-iottly">
<h1>Python SDK iottly<a class="headerlink" href="#python-sdk-iottly" title="Permalink to this headline">¶</a></h1>
<p>Python module handling interaction with the <a class="reference external" href="https://iottly.com/">iottly</a> agent from third-party applications installed locally on the device.</p>
<p>For example the custom application takes care of the interactions with the
low level hardware and buses, while delegating to the iottly Agent the secure
communication over MQTT.</p>
<p>Moreover the custom application can invoke python scripts registered in the Agent
to perform tasks like complex event detection and correlations. This is like
“functions as a service on embedded devices”, and turns out to be particularly
useful if the rules must be updated frequently or different versions of the rules
must be maintained for devices in different installations.</p>
<img alt="_images/image.png" src="_images/image.png" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Briefly, the registered app can:</p>
<blockquote>
<div><ul class="simple">
<li><p>Send messages to iottly</p></li>
<li><p>Subscribe to specifics commands received from the iottly-agent</p></li>
<li><p>Call a Python snippet in the user-defined scripts of the attached Agent</p></li>
<li><p>Register callbacks on specifics iottly-agent notification</p></li>
</ul>
</div></blockquote>
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>How it works:</p>
<img alt="_images/Agent_SDK.jpg" src="_images/Agent_SDK.jpg" />
<div class="line-block">
<div class="line"><br /></div>
</div>
<p>Example snippet:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>

<span class="kn">from</span> <span class="nn">iottly_sdk</span> <span class="kn">import</span> <span class="n">IottlySDK</span>

<span class="c1"># Define callback to receive notifications</span>
<span class="c1"># about the iottly agent status:</span>
<span class="c1"># -  started</span>
<span class="c1"># -  stopping</span>
<span class="c1"># -  stopped</span>
<span class="k">def</span> <span class="nf">on_agent_status_changed</span><span class="p">(</span><span class="n">status</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;on_agent_status_changed: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>

<span class="c1"># Define callback to receive notifications</span>
<span class="c1"># about the iottly agent mqtt connection status:</span>
<span class="c1"># -  connected</span>
<span class="c1"># -  disconnected</span>
<span class="k">def</span> <span class="nf">on_connection_status_changed</span><span class="p">(</span><span class="n">status</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;on_connection_status_changed: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>

<span class="c1"># Create an instance of IottlySDK with:</span>
<span class="c1"># -  a &quot;name&quot; to identify your application (this will appear</span>
<span class="c1">#    in the dashboard logs)</span>
<span class="c1"># -  the optional number of messages retained if agent is</span>
<span class="c1">#    down (defaults to 10)</span>
<span class="c1"># -  the previously defined callbacks (optional) to receive</span>
<span class="c1">#    agent status notifications</span>
<span class="n">iottlysdk</span> <span class="o">=</span> <span class="n">IottlySDK</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;myfirstiottlyapp&#39;</span><span class="p">,</span>
    <span class="n">max_buffered_msgs</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">on_agent_status_changed</span><span class="o">=</span><span class="n">on_agent_status_changed</span><span class="p">,</span>
    <span class="n">on_connection_status_changed</span><span class="o">=</span><span class="n">on_connection_status_changed</span><span class="p">)</span>

<span class="c1"># Define one callback for each incoming commands you want to</span>
<span class="c1"># subscribe to. Commands are defined in the iottly</span>
<span class="c1"># dashboard / management commands panel.</span>
<span class="k">def</span> <span class="nf">on_echo_received</span><span class="p">(</span><span class="n">cmdpars</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;on_echo_received: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cmdpars</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">on_examplecommand_received</span><span class="p">(</span><span class="n">cmdpars</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;on_examplecommand_received: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cmdpars</span><span class="p">))</span>

<span class="c1"># Subscribe commands of interest and associate a callback</span>
<span class="n">iottlysdk</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span>
    <span class="n">cmd_type</span><span class="o">=</span><span class="s1">&#39;echo&#39;</span><span class="p">,</span>
    <span class="n">callback</span><span class="o">=</span><span class="n">on_echo_received</span>
<span class="p">)</span>
<span class="n">iottlysdk</span><span class="o">.</span><span class="n">subscribe</span><span class="p">(</span>
    <span class="n">cmd_type</span><span class="o">=</span><span class="s1">&#39;examplecommand&#39;</span><span class="p">,</span>
    <span class="n">callback</span><span class="o">=</span><span class="n">on_examplecommand_received</span>
<span class="p">)</span>

<span class="c1"># Start the sdk loops</span>
<span class="n">iottlysdk</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="c1"># Here follows the main blocking loop of your application.</span>
<span class="c1"># It &quot;reads a temperature&quot; and send it to iottly using</span>
<span class="c1"># the &#39;send&#39; method.</span>
<span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">s</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
            <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">^C to exit, &quot;m&quot; to send 1 message, &#39;</span>
            <span class="s1">&#39;&quot;l&quot; to send 20 messages:</span><span class="se">\n</span><span class="s1">&#39;</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;m&#39;</span><span class="p">:</span>
            <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;temperature&#39;</span><span class="p">:</span> <span class="mi">22</span><span class="p">}</span>
            <span class="c1"># send a message to iottly</span>
            <span class="n">iottlysdk</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">s</span> <span class="o">==</span> <span class="s1">&#39;l&#39;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">):</span>
                <span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;temperature&#39;</span><span class="p">:</span> <span class="n">t</span><span class="p">}</span>

                <span class="c1"># send a message to iottly</span>
                <span class="n">iottlysdk</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="k">break</span>
</pre></div>
</div>
<div class="line-block">
<div class="line"><br /></div>
</div>
<div class="toctree-wrapper compound">
<p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="API.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="porting.html">Porting</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper"><div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="#">Documentation overview</a><ul>
      <li>Next: <a href="installation.html" title="next chapter">Installation</a></li>
  </ul></li>
</ul>
</div>
<p class="logo">
  <a href="#">
    <img class="logo" src="_static/logo.png" alt="Logo"/>
    
  </a>
</p>



<p class="blurb">Python SDK for iottly</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=tomorrowdata&repo=iottly-sdk-python&type=watch&count=false&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<p class="caption"><span class="caption-text">Table of Contents</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="API.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="porting.html">Porting</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, TomorrowData Srl.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.1.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/index.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>